Hello everybody,I need some help! I'm preparing library for I2C PCF8591 (A/D and D/A converter). It doesn't work....Data sheet: PCF8591I think the problem might be writing the control byte...Lib, device description and project are attached to this post.Does anyone have any suggestions or finds an error?BRKdebuAttachment:PCF8591.zipAttachment:PCF8591.rar

Nobody any suggestions?

Hi,You are writing 00 into Control register after init. I think that you have to enable analog output (bit 7 in control register), so you have to write:Code:write8(control, 16#80); // Control ByteDevice address 4F is ok if you have A0,A1,A2 connected to Vdd. Please check this.Because you only set channel number in control register to 00, you can only read AIN0.I hope this will help.Please report the result.BRZdenko.

Hi Zdenko,To enable the DAC i have to write 0x40 (0100 0000) into the control register.Reading AIN0: 0x00 (or 0x40 with enabled DAC) - single ended inputReading AIN1: 0x01 (or 0x41 with enabled DAC) - single ended inputReading AIN2: 0x02 (or 0x42 with enabled DAC) - single ended inputReading AIN3: 0x03 (or 0x43 with enabled DAC) - single ended inputThe device address 0x4F must be correct. A0, A1 and A2 are connected to Vdd. I checked this also with i2c-tools.Reading the ADC-inputs and writing into the DAC-register still does not work correctly. The read ADC-values and the DAC-output voltage (measured with a multimeter) are not correct.I checked the function of my board with a c- and python-script. The PCF8591 worked correctly... So it must be a "CODESYS-problem". BRkdebu

Hi Kdebu,yes, you are right. To enable DAC you have to write 0x40 into control register. I missed one bit.But in your case, you are not writing this value in the device control register nowhere. Please make sure that write value to control register will be performed before reading/writing DAC/ADCs.BRZdenko.

Hello Zdenko,i updated my project (see attached file(s)) but it still doesn't work...   I think the program logic should be correct... Please take a look again.BRkdebu

Hi,we need more description, what exactly does not work,any screenshot of debugging it, would be great.BREdwin

I have the same problem i cant get PCF8591 to send a signal from my potentiometerim useing this code in a ST POUPROGRAM PCF8591_TestVAR	Potentiometer : LREAL;END_VARPCF8591.CNF := 16#40;Potentiometer := BYTE_TO_LREAL(PCF8591.IN_A);//Christos

I just wrote a program in python and tried out the PCF8591 with a potentiometer connected to the first port and the program ran nicely everything worked. So i know now the ic works 100%. But i can still not get it to work in codesys Ive added an i2c master and under that the device PCF8591 wich i downloaded from the forum. Part of the problem is i cant understand the functionblock 100% as I understand it know you want me to send the init byte to PCF8591.CNF and that will activate the ports to be able to recive data. Right now im running and ST program that looks like this:PCF8591.CNF := 16#48;Potentiometer := BYTE_TO_LREAL(PCF8591.IN_A);Potentiometer1 := BYTE_TO_LREAL(PCF8591.IN_B);Potentiometer2 := BYTE_TO_LREAL(PCF8591.IN_C);Potentiometer2 := BYTE_TO_LREAL(PCF8591.IN_D);Im out of ideas, so i hope someone on the forum have any.//Christos

I solved it forgot to write an address on my PCF8591 device.Address the device you add under the I2C master with the value 16#48and just make an ST POU and write:input0 := BYTE_TO_REAL (PCF8591.IN_A);and you should get a value on IN_A if you connected something to the first port on the IC.//Christos

